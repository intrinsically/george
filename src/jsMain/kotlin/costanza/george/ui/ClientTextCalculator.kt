package costanza.george.ui

import costanza.george.diagrams.base.FontDetails
import costanza.george.diagrams.base.ITextCalculator
import kotlin.math.max


class ClientTextCalculator: ITextCalculator {
    /** values are calculated from the graphics2d java font metrics */
    private val TEXT_HEIGHTS = arrayOf(19.0, 16.0, 15.0, 15.0)
    private val TEXT_WIDTHS = arrayOf<Array<Double>>(
        arrayOf(0.0, 0.0, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 0.0, 5.5, 5.5, 6.6000000000000005, 6.6000000000000005, 5.5, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 0.0, 6.6000000000000005, 6.6000000000000005, 5.5, 6.6000000000000005, 9.9, 11.0, 11.0, 17.6, 14.3, 4.4, 6.6000000000000005, 6.6000000000000005, 7.700000000000001, 12.100000000000001, 5.5, 6.6000000000000005, 5.5, 5.5, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 6.6000000000000005, 6.6000000000000005, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 19.8, 14.3, 14.3, 14.3, 14.3, 13.200000000000001, 12.100000000000001, 15.400000000000002, 14.3, 5.5, 11.0, 14.3, 12.100000000000001, 16.5, 14.3, 15.400000000000002, 13.200000000000001, 15.400000000000002, 14.3, 13.200000000000001, 12.100000000000001, 14.3, 13.200000000000001, 18.700000000000003, 13.200000000000001, 13.200000000000001, 12.100000000000001, 6.6000000000000005, 5.5, 6.6000000000000005, 12.100000000000001, 11.0, 6.6000000000000005, 11.0, 12.100000000000001, 11.0, 12.100000000000001, 11.0, 6.6000000000000005, 12.100000000000001, 12.100000000000001, 5.5, 5.5, 11.0, 5.5, 17.6, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 7.700000000000001, 11.0, 6.6000000000000005, 12.100000000000001, 11.0, 15.400000000000002, 11.0, 11.0, 9.9, 7.700000000000001, 5.5, 7.700000000000001, 12.100000000000001, 0.0, 11.0, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 19.8, 5.5, 6.6000000000000005, 11.0, 11.0, 11.0, 11.0, 5.5, 11.0, 6.6000000000000005, 14.3, 7.700000000000001, 11.0, 12.100000000000001, 6.6000000000000005, 14.3, 6.6000000000000005, 7.700000000000001, 11.0, 6.6000000000000005, 6.6000000000000005, 6.6000000000000005, 11.0, 11.0, 5.5, 6.6000000000000005, 6.6000000000000005, 7.700000000000001, 11.0, 16.5, 16.5, 16.5, 12.100000000000001, 14.3, 14.3, 14.3, 14.3, 14.3, 14.3, 19.8, 14.3, 13.200000000000001, 13.200000000000001, 13.200000000000001, 13.200000000000001, 5.5, 5.5, 5.5, 5.5, 14.3, 14.3, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 12.100000000000001, 15.400000000000002, 14.3, 14.3, 14.3, 14.3, 13.200000000000001, 13.200000000000001, 12.100000000000001, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 17.6, 11.0, 11.0, 11.0, 11.0, 11.0, 5.5, 5.5, 5.5, 5.5, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 11.0, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 11.0, 12.100000000000001, 11.0),
        arrayOf(0.0, 0.0, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 4.4, 4.4, 5.5, 5.5, 4.4, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 5.5, 5.5, 4.4, 4.4, 5.5, 8.8, 8.8, 14.3, 11.0, 3.3000000000000003, 5.5, 5.5, 6.6000000000000005, 9.9, 4.4, 5.5, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 9.9, 9.9, 9.9, 8.8, 16.5, 11.0, 11.0, 12.100000000000001, 12.100000000000001, 11.0, 9.9, 13.200000000000001, 12.100000000000001, 4.4, 8.8, 11.0, 8.8, 13.200000000000001, 12.100000000000001, 13.200000000000001, 11.0, 13.200000000000001, 12.100000000000001, 11.0, 9.9, 12.100000000000001, 11.0, 15.400000000000002, 11.0, 11.0, 9.9, 4.4, 4.4, 4.4, 7.700000000000001, 8.8, 5.5, 8.8, 8.8, 8.8, 8.8, 8.8, 4.4, 8.8, 8.8, 3.3000000000000003, 3.3000000000000003, 8.8, 3.3000000000000003, 13.200000000000001, 8.8, 8.8, 8.8, 8.8, 5.5, 8.8, 4.4, 8.8, 8.8, 12.100000000000001, 8.8, 8.8, 8.8, 5.5, 4.4, 5.5, 9.9, 0.0, 8.8, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 16.5, 4.4, 5.5, 8.8, 8.8, 8.8, 8.8, 4.4, 8.8, 5.5, 12.100000000000001, 6.6000000000000005, 8.8, 9.9, 5.5, 12.100000000000001, 5.5, 6.6000000000000005, 8.8, 5.5, 5.5, 5.5, 9.9, 8.8, 4.4, 5.5, 5.5, 5.5, 8.8, 14.3, 14.3, 14.3, 9.9, 11.0, 11.0, 11.0, 11.0, 11.0, 11.0, 16.5, 12.100000000000001, 11.0, 11.0, 11.0, 11.0, 4.4, 4.4, 4.4, 4.4, 12.100000000000001, 12.100000000000001, 13.200000000000001, 13.200000000000001, 13.200000000000001, 13.200000000000001, 13.200000000000001, 9.9, 13.200000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 11.0, 11.0, 9.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 14.3, 8.8, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 9.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8),
        arrayOf(0.0, 0.0, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 4.4, 4.4, 5.5, 5.5, 4.4, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 5.5, 5.5, 4.4, 4.4, 5.5, 8.8, 8.8, 13.200000000000001, 9.9, 3.3000000000000003, 5.5, 5.5, 5.5, 8.8, 4.4, 5.5, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 15.400000000000002, 9.9, 9.9, 11.0, 11.0, 9.9, 9.9, 12.100000000000001, 11.0, 4.4, 7.700000000000001, 9.9, 8.8, 13.200000000000001, 11.0, 12.100000000000001, 9.9, 12.100000000000001, 11.0, 9.9, 9.9, 11.0, 9.9, 14.3, 9.9, 9.9, 9.9, 4.4, 4.4, 4.4, 7.700000000000001, 8.8, 5.5, 8.8, 8.8, 7.700000000000001, 8.8, 8.8, 4.4, 8.8, 8.8, 3.3000000000000003, 3.3000000000000003, 7.700000000000001, 3.3000000000000003, 13.200000000000001, 8.8, 8.8, 8.8, 8.8, 5.5, 7.700000000000001, 4.4, 8.8, 7.700000000000001, 11.0, 7.700000000000001, 7.700000000000001, 7.700000000000001, 5.5, 4.4, 5.5, 8.8, 0.0, 8.8, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 4.4, 5.5, 8.8, 8.8, 8.8, 8.8, 4.4, 8.8, 5.5, 11.0, 5.5, 8.8, 8.8, 5.5, 11.0, 5.5, 6.6000000000000005, 8.8, 5.5, 5.5, 5.5, 8.8, 8.8, 4.4, 5.5, 5.5, 5.5, 8.8, 13.200000000000001, 13.200000000000001, 13.200000000000001, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 15.400000000000002, 11.0, 9.9, 9.9, 9.9, 9.9, 4.4, 4.4, 4.4, 4.4, 11.0, 11.0, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 8.8, 12.100000000000001, 11.0, 11.0, 11.0, 11.0, 9.9, 9.9, 9.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 13.200000000000001, 7.700000000000001, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 9.9, 8.8, 8.8, 8.8, 8.8, 7.700000000000001, 8.8, 7.700000000000001),
        arrayOf(0.0, 0.0, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 4.4, 4.4, 5.5, 5.5, 4.4, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 0.0, 5.5, 5.5, 4.4, 4.4, 5.5, 8.8, 8.8, 13.200000000000001, 9.9, 3.3000000000000003, 5.5, 5.5, 5.5, 8.8, 4.4, 5.5, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 15.400000000000002, 9.9, 9.9, 11.0, 11.0, 9.9, 9.9, 12.100000000000001, 11.0, 4.4, 7.700000000000001, 9.9, 8.8, 13.200000000000001, 11.0, 12.100000000000001, 9.9, 12.100000000000001, 11.0, 9.9, 9.9, 11.0, 9.9, 14.3, 9.9, 9.9, 9.9, 4.4, 4.4, 4.4, 7.700000000000001, 8.8, 5.5, 8.8, 8.8, 7.700000000000001, 8.8, 8.8, 4.4, 8.8, 8.8, 3.3000000000000003, 3.3000000000000003, 7.700000000000001, 3.3000000000000003, 13.200000000000001, 8.8, 8.8, 8.8, 8.8, 5.5, 7.700000000000001, 4.4, 8.8, 7.700000000000001, 11.0, 7.700000000000001, 7.700000000000001, 7.700000000000001, 5.5, 4.4, 5.5, 8.8, 0.0, 8.8, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 15.400000000000002, 4.4, 5.5, 8.8, 8.8, 8.8, 8.8, 4.4, 8.8, 5.5, 11.0, 5.5, 8.8, 8.8, 5.5, 11.0, 5.5, 6.6000000000000005, 8.8, 5.5, 5.5, 5.5, 8.8, 8.8, 4.4, 5.5, 5.5, 5.5, 8.8, 13.200000000000001, 13.200000000000001, 13.200000000000001, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 9.9, 15.400000000000002, 11.0, 9.9, 9.9, 9.9, 9.9, 4.4, 4.4, 4.4, 4.4, 11.0, 11.0, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 12.100000000000001, 8.8, 12.100000000000001, 11.0, 11.0, 11.0, 11.0, 9.9, 9.9, 9.9, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 13.200000000000001, 7.700000000000001, 8.8, 8.8, 8.8, 8.8, 4.4, 4.4, 4.4, 4.4, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 8.8, 9.9, 8.8, 8.8, 8.8, 8.8, 7.700000000000001, 8.8, 7.700000000000001),
    )
    override fun calcHeight(details: FontDetails): Double {
        return TEXT_HEIGHTS[details.ordinal]
    }

    override fun calcWidth(details: FontDetails, minWidth: Double, text: String): Double {
        // add up the individual characters, if they are < 255
        val ord = details.ordinal
        val sum = text.fold(0.0) { total, char ->
            total + if (char.code < 256) TEXT_WIDTHS[ord][char.code] else 0.0 }
        return max(sum * 1.1, minWidth)
    }
}